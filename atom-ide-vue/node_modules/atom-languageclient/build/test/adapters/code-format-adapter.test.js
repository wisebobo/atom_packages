"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
const chai_1 = require("chai");
const sinon = require("sinon");
const convert_1 = require("../../lib/convert");
const ls = require("../../lib/languageclient");
const code_format_adapter_1 = require("../../lib/adapters/code-format-adapter");
const helpers_js_1 = require("../helpers.js");
describe('CodeFormatAdapter', () => {
    let fakeEditor;
    let connection;
    let range;
    beforeEach(() => {
        connection = new ls.LanguageClientConnection(helpers_js_1.createSpyConnection());
        fakeEditor = helpers_js_1.createFakeEditor();
        range = new atom_1.Range([0, 0], [100, 100]);
    });
    describe('canAdapt', () => {
        it('returns true if range formatting is supported', () => {
            const result = code_format_adapter_1.default.canAdapt({
                documentRangeFormattingProvider: true,
            });
            chai_1.expect(result).to.be.true;
        });
        it('returns true if document formatting is supported', () => {
            const result = code_format_adapter_1.default.canAdapt({
                documentFormattingProvider: true,
            });
            chai_1.expect(result).to.be.true;
        });
        it('returns false it no formatting supported', () => {
            const result = code_format_adapter_1.default.canAdapt({});
            chai_1.expect(result).to.be.false;
        });
    });
    describe('format', () => {
        it('prefers range formatting if available', () => {
            const rangeStub = sinon.spy(connection, 'documentRangeFormatting');
            const docStub = sinon.spy(connection, 'documentFormatting');
            code_format_adapter_1.default.format(connection, {
                documentRangeFormattingProvider: true,
                documentFormattingProvider: true,
            }, fakeEditor, range);
            chai_1.expect(rangeStub.called).to.be.true;
            chai_1.expect(docStub.called).to.be.false;
        });
        it('falls back to document formatting if range formatting not available', () => {
            const rangeStub = sinon.spy(connection, 'documentRangeFormatting');
            const docStub = sinon.spy(connection, 'documentFormatting');
            code_format_adapter_1.default.format(connection, { documentFormattingProvider: true }, fakeEditor, range);
            chai_1.expect(rangeStub.called).to.be.false;
            chai_1.expect(docStub.called).to.be.true;
        });
        it('throws if neither range or document formatting are supported', () => {
            chai_1.expect(() => code_format_adapter_1.default.format(connection, {}, fakeEditor, range)).to.throw('');
        });
    });
    describe('formatDocument', () => {
        it('converts the results from the connection', () => __awaiter(void 0, void 0, void 0, function* () {
            sinon.stub(connection, 'documentFormatting').resolves([
                {
                    range: {
                        start: { line: 0, character: 1 },
                        end: { line: 0, character: 2 },
                    },
                    newText: 'abc',
                },
                {
                    range: {
                        start: { line: 5, character: 10 },
                        end: { line: 15, character: 20 },
                    },
                    newText: 'def',
                },
            ]);
            const actual = yield code_format_adapter_1.default.formatDocument(connection, fakeEditor);
            chai_1.expect(actual.length).to.equal(2);
            chai_1.expect(actual[0].newText).to.equal('abc');
            chai_1.expect(actual[1].oldRange.start.row).to.equal(5);
            chai_1.expect(actual[1].oldRange.start.column).to.equal(10);
            chai_1.expect(actual[1].oldRange.end.row).to.equal(15);
            chai_1.expect(actual[1].oldRange.end.column).to.equal(20);
            chai_1.expect(actual[1].newText).to.equal('def');
        }));
    });
    describe('createDocumentFormattingParams', () => {
        it('returns the tab size from the editor', () => {
            sinon.stub(fakeEditor, 'getPath').returns('/a/b/c/d.txt');
            sinon.stub(fakeEditor, 'getTabLength').returns(1);
            sinon.stub(fakeEditor, 'getSoftTabs').returns(false);
            const actual = code_format_adapter_1.default.createDocumentFormattingParams(fakeEditor);
            chai_1.expect(actual.textDocument).to.eql({ uri: 'file:///a/b/c/d.txt' });
            chai_1.expect(actual.options.tabSize).to.equal(1);
            chai_1.expect(actual.options.insertSpaces).to.equal(false);
        });
    });
    describe('formatRange', () => {
        it('converts the results from the connection', () => __awaiter(void 0, void 0, void 0, function* () {
            sinon.stub(connection, 'documentRangeFormatting').resolves([
                {
                    range: {
                        start: { line: 0, character: 1 },
                        end: { line: 0, character: 2 },
                    },
                    newText: 'abc',
                },
                {
                    range: {
                        start: { line: 5, character: 10 },
                        end: { line: 15, character: 20 },
                    },
                    newText: 'def',
                },
            ]);
            const actual = yield code_format_adapter_1.default.formatRange(connection, fakeEditor, new atom_1.Range([0, 0], [1, 1]));
            chai_1.expect(actual.length).to.equal(2);
            chai_1.expect(actual[0].newText).to.equal('abc');
            chai_1.expect(actual[1].oldRange.start.row).to.equal(5);
            chai_1.expect(actual[1].oldRange.start.column).to.equal(10);
            chai_1.expect(actual[1].oldRange.end.row).to.equal(15);
            chai_1.expect(actual[1].oldRange.end.column).to.equal(20);
            chai_1.expect(actual[1].newText).to.equal('def');
        }));
    });
    describe('createDocumentRangeFormattingParams', () => {
        it('returns the tab size from the editor', () => {
            sinon.stub(fakeEditor, 'getPath').returns('/a/b/c/d.txt');
            sinon.stub(fakeEditor, 'getTabLength').returns(1);
            sinon.stub(fakeEditor, 'getSoftTabs').returns(false);
            const actual = code_format_adapter_1.default.createDocumentRangeFormattingParams(fakeEditor, new atom_1.Range([1, 0], [2, 3]));
            chai_1.expect(actual.textDocument).to.eql({ uri: 'file:///a/b/c/d.txt' });
            chai_1.expect(actual.range).to.eql({
                start: { line: 1, character: 0 },
                end: { line: 2, character: 3 },
            });
            chai_1.expect(actual.options.tabSize).to.equal(1);
            chai_1.expect(actual.options.insertSpaces).to.equal(false);
        });
    });
    describe('getFormatOptions', () => {
        it('returns the tab size from the editor', () => {
            sinon.stub(fakeEditor, 'getTabLength').returns(17);
            const options = code_format_adapter_1.default.getFormatOptions(fakeEditor);
            chai_1.expect(options.tabSize).to.equal(17);
        });
        it('returns the soft tab setting from the editor', () => {
            sinon.stub(fakeEditor, 'getSoftTabs').returns(true);
            const options = code_format_adapter_1.default.getFormatOptions(fakeEditor);
            chai_1.expect(options.insertSpaces).to.be.true;
        });
    });
    describe('convertLsTextEdit', () => {
        it('returns oldRange and newText from a textEdit', () => {
            const textEdit = {
                range: {
                    start: { line: 1, character: 0 },
                    end: { line: 2, character: 3 },
                },
                newText: 'abc-def',
            };
            const actual = convert_1.default.convertLsTextEdit(textEdit);
            chai_1.expect(actual.oldRange).to.eql(new atom_1.Range([1, 0], [2, 3]));
            chai_1.expect(actual.newText).to.equal('abc-def');
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZS1mb3JtYXQtYWRhcHRlci50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vdGVzdC9hZGFwdGVycy9jb2RlLWZvcm1hdC1hZGFwdGVyLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSwrQkFBNkI7QUFDN0IsK0JBQThCO0FBQzlCLCtCQUErQjtBQUMvQiwrQ0FBd0M7QUFDeEMsK0NBQStDO0FBQy9DLGdGQUF1RTtBQUN2RSw4Q0FBc0U7QUFFdEUsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUNqQyxJQUFJLFVBQWUsQ0FBQztJQUNwQixJQUFJLFVBQWUsQ0FBQztJQUNwQixJQUFJLEtBQVUsQ0FBQztJQUVmLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxVQUFVLEdBQUcsSUFBSSxFQUFFLENBQUMsd0JBQXdCLENBQUMsZ0NBQW1CLEVBQUUsQ0FBQyxDQUFDO1FBQ3BFLFVBQVUsR0FBRyw2QkFBZ0IsRUFBRSxDQUFDO1FBQ2hDLEtBQUssR0FBRyxJQUFJLFlBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3hDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUU7UUFDeEIsRUFBRSxDQUFDLCtDQUErQyxFQUFFLEdBQUcsRUFBRTtZQUN2RCxNQUFNLE1BQU0sR0FBRyw2QkFBaUIsQ0FBQyxRQUFRLENBQUM7Z0JBQ3hDLCtCQUErQixFQUFFLElBQUk7YUFDdEMsQ0FBQyxDQUFDO1lBQ0gsYUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDO1FBQzVCLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGtEQUFrRCxFQUFFLEdBQUcsRUFBRTtZQUMxRCxNQUFNLE1BQU0sR0FBRyw2QkFBaUIsQ0FB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LENBQUMsVUFBVSxDQUFDLENBQUM7WUFDL0QsYUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQztRQUMxQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUNqQyxFQUFFLENBQUMsOENBQThDLEVBQUUsR0FBRyxFQUFFO1lBQ3RELE1BQU0sUUFBUSxHQUFHO2dCQUNmLEtBQUssRUFBRTtvQkFDTCxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUU7b0JBQ2hDLEdBQUcsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRTtpQkFDL0I7Z0JBQ0QsT0FBTyxFQUFFLFNBQVM7YUFDbkIsQ0FBQztZQUNGLE1BQU0sTUFBTSxHQUFHLGlCQUFPLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDbkQsYUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksWUFBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxRCxhQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDN0MsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmFuZ2UgfSBmcm9tICdhdG9tJztcbmltcG9ydCB7IGV4cGVjdCB9IGZyb20gJ2NoYWknO1xuaW1wb3J0ICogYXMgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IENvbnZlcnQgZnJvbSAnLi4vLi4vbGliL2NvbnZlcnQnO1xuaW1wb3J0ICogYXMgbHMgZnJvbSAnLi4vLi4vbGliL2xhbmd1YWdlY2xpZW50JztcbmltcG9ydCBDb2RlRm9ybWF0QWRhcHRlciBmcm9tICcuLi8uLi9saWIvYWRhcHRlcnMvY29kZS1mb3JtYXQtYWRhcHRlcic7XG5pbXBvcnQgeyBjcmVhdGVTcHlDb25uZWN0aW9uLCBjcmVhdGVGYWtlRWRpdG9yIH0gZnJvbSAnLi4vaGVscGVycy5qcyc7XG5cbmRlc2NyaWJlKCdDb2RlRm9ybWF0QWRhcHRlcicsICgpID0+IHtcbiAgbGV0IGZha2VFZGl0b3I6IGFueTtcbiAgbGV0IGNvbm5lY3Rpb246IGFueTtcbiAgbGV0IHJhbmdlOiBhbnk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgY29ubmVjdGlvbiA9IG5ldyBscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb24oY3JlYXRlU3B5Q29ubmVjdGlvbigpKTtcbiAgICBmYWtlRWRpdG9yID0gY3JlYXRlRmFrZUVkaXRvcigpO1xuICAgIHJhbmdlID0gbmV3IFJhbmdlKFswLCAwXSwgWzEwMCwgMTAwXSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjYW5BZGFwdCcsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyB0cnVlIGlmIHJhbmdlIGZvcm1hdHRpbmcgaXMgc3VwcG9ydGVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gQ29kZUZvcm1hdEFkYXB0ZXIuY2FuQWRhcHQoe1xuICAgICAgICBkb2N1bWVudFJhbmdlRm9ybWF0dGluZ1Byb3ZpZGVyOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50by5iZS50cnVlO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgdHJ1ZSBpZiBkb2N1bWVudCBmb3JtYXR0aW5nIGlzIHN1cHBvcnRlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IENvZGVGb3JtYXRBZGFwdGVyLmNhbkFkYXB0KHtcbiAgICAgICAgZG9jdW1lbnRGb3JtYXR0aW5nUHJvdmlkZXI6IHRydWUsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmJlLnRydWU7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBmYWxzZSBpdCBubyBmb3JtYXR0aW5nIHN1cHBvcnRlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IENvZGVGb3JtYXRBZGFwdGVyLmNhbkFkYXB0KHt9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmJlLmZhbHNlO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZm9ybWF0JywgKCkgPT4ge1xuICAgIGl0KCdwcmVmZXJzIHJhbmdlIGZvcm1hdHRpbmcgaWYgYXZhaWxhYmxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmFuZ2VTdHViID0gc2lub24uc3B5KGNvbm5lY3Rpb24sICdkb2N1bWVudFJhbmdlRm9ybWF0dGluZycpO1xuICAgICAgY29uc3QgZG9jU3R1YiA9IHNpbm9uLnNweShjb25uZWN0aW9uLCAnZG9jdW1lbnRGb3JtYXR0aW5nJyk7XG4gICAgICBDb2RlRm9ybWF0QWRhcHRlci5mb3JtYXQoXG4gICAgICAgIGNvbm5lY3Rpb24sXG4gICAgICAgIHtcbiAgICAgICAgICBkb2N1bWVudFJhbmdlRm9ybWF0dGluZ1Byb3ZpZGVyOiB0cnVlLFxuICAgICAgICAgIGRvY3VtZW50Rm9ybWF0dGluZ1Byb3ZpZGVyOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBmYWtlRWRpdG9yLFxuICAgICAgICByYW5nZSxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmFuZ2VTdHViLmNhbGxlZCkudG8uYmUudHJ1ZTtcbiAgICAgIGV4cGVjdChkb2NTdHViLmNhbGxlZCkudG8uYmUuZmFsc2U7XG4gICAgfSk7XG5cbiAgICBpdCgnZmFsbHMgYmFjayB0byBkb2N1bWVudCBmb3JtYXR0aW5nIGlmIHJhbmdlIGZvcm1hdHRpbmcgbm90IGF2YWlsYWJsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJhbmdlU3R1YiA9IHNpbm9uLnNweShjb25uZWN0aW9uLCAnZG9jdW1lbnRSYW5nZUZvcm1hdHRpbmcnKTtcbiAgICAgIGNvbnN0IGRvY1N0dWIgPSBzaW5vbi5zcHkoY29ubmVjdGlvbiwgJ2RvY3VtZW50Rm9ybWF0dGluZycpO1xuICAgICAgQ29kZUZvcm1hdEFkYXB0ZXIuZm9ybWF0KGNvbm5lY3Rpb24sIHsgZG9jdW1lbnRGb3JtYXR0aW5nUHJvdmlkZXI6IHRydWUgfSwgZmFrZUVkaXRvciwgcmFuZ2UpO1xuICAgICAgZXhwZWN0KHJhbmdlU3R1Yi5jYWxsZWQpLnRvLmJlLmZhbHNlO1xuICAgICAgZXhwZWN0KGRvY1N0dWIuY2FsbGVkKS50by5iZS50cnVlO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Rocm93cyBpZiBuZWl0aGVyIHJhbmdlIG9yIGRvY3VtZW50IGZvcm1hdHRpbmcgYXJlIHN1cHBvcnRlZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdCgoKSA9PiBDb2RlRm9ybWF0QWRhcHRlci5mb3JtYXQoY29ubmVjdGlvbiwge30sIGZha2VFZGl0b3IsIHJhbmdlKSkudG8udGhyb3coJycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZm9ybWF0RG9jdW1lbnQnLCAoKSA9PiB7XG4gICAgaXQoJ2NvbnZlcnRzIHRoZSByZXN1bHRzIGZyb20gdGhlIGNvbm5lY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBzaW5vbi5zdHViKGNvbm5lY3Rpb24sICdkb2N1bWVudEZvcm1hdHRpbmcnKS5yZXNvbHZlcyhbXG4gICAgICAgIHtcbiAgICAgICAgICByYW5nZToge1xuICAgICAgICAgICAgc3RhcnQ6IHsgbGluZTogMCwgY2hhcmFjdGVyOiAxIH0sXG4gICAgICAgICAgICBlbmQ6IHsgbGluZTogMCwgY2hhcmFjdGVyOiAyIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBuZXdUZXh0OiAnYWJjJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHJhbmdlOiB7XG4gICAgICAgICAgICBzdGFydDogeyBsaW5lOiA1LCBjaGFyYWN0ZXI6IDEwIH0sXG4gICAgICAgICAgICBlbmQ6IHsgbGluZTogMTUsIGNoYXJhY3RlcjogMjAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG5ld1RleHQ6ICdkZWYnLFxuICAgICAgICB9LFxuICAgICAgXSk7XG4gICAgICBjb25zdCBhY3R1YWwgPSBhd2FpdCBDb2RlRm9ybWF0QWRhcHRlci5mb3JtYXREb2N1bWVudChjb25uZWN0aW9uLCBmYWtlRWRpdG9yKTtcbiAgICAgIGV4cGVjdChhY3R1YWwubGVuZ3RoKS50by5lcXVhbCgyKTtcbiAgICAgIGV4cGVjdChhY3R1YWxbMF0ubmV3VGV4dCkudG8uZXF1YWwoJ2FiYycpO1xuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5zdGFydC5yb3cpLnRvLmVxdWFsKDUpO1xuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5zdGFydC5jb2x1bW4pLnRvLmVxdWFsKDEwKTtcbiAgICAgIGV4cGVjdChhY3R1YWxbMV0ub2xkUmFuZ2UuZW5kLnJvdykudG8uZXF1YWwoMTUpO1xuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5lbmQuY29sdW1uKS50by5lcXVhbCgyMCk7XG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm5ld1RleHQpLnRvLmVxdWFsKCdkZWYnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZURvY3VtZW50Rm9ybWF0dGluZ1BhcmFtcycsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyB0aGUgdGFiIHNpemUgZnJvbSB0aGUgZWRpdG9yJywgKCkgPT4ge1xuICAgICAgc2lub24uc3R1YihmYWtlRWRpdG9yLCAnZ2V0UGF0aCcpLnJldHVybnMoJy9hL2IvYy9kLnR4dCcpO1xuICAgICAgc2lub24uc3R1YihmYWtlRWRpdG9yLCAnZ2V0VGFiTGVuZ3RoJykucmV0dXJucygxKTtcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFNvZnRUYWJzJykucmV0dXJucyhmYWxzZSk7XG5cbiAgICAgIGNvbnN0IGFjdHVhbCA9IENvZGVGb3JtYXRBZGFwdGVyLmNyZWF0ZURvY3VtZW50Rm9ybWF0dGluZ1BhcmFtcyhmYWtlRWRpdG9yKTtcblxuICAgICAgZXhwZWN0KGFjdHVhbC50ZXh0RG9jdW1lbnQpLnRvLmVxbCh7IHVyaTogJ2ZpbGU6Ly8vYS9iL2MvZC50eHQnIH0pO1xuICAgICAgZXhwZWN0KGFjdHVhbC5vcHRpb25zLnRhYlNpemUpLnRvLmVxdWFsKDEpO1xuICAgICAgZXhwZWN0KGFjdHVhbC5vcHRpb25zLmluc2VydFNwYWNlcykudG8uZXF1YWwoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZm9ybWF0UmFuZ2UnLCAoKSA9PiB7XG4gICAgaXQoJ2NvbnZlcnRzIHRoZSByZXN1bHRzIGZyb20gdGhlIGNvbm5lY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBzaW5vbi5zdHViKGNvbm5lY3Rpb24sICdkb2N1bWVudFJhbmdlRm9ybWF0dGluZycpLnJlc29sdmVzKFtcbiAgICAgICAge1xuICAgICAgICAgIHJhbmdlOiB7XG4gICAgICAgICAgICBzdGFydDogeyBsaW5lOiAwLCBjaGFyYWN0ZXI6IDEgfSxcbiAgICAgICAgICAgIGVuZDogeyBsaW5lOiAwLCBjaGFyYWN0ZXI6IDIgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG5ld1RleHQ6ICdhYmMnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcmFuZ2U6IHtcbiAgICAgICAgICAgIHN0YXJ0OiB7IGxpbmU6IDUsIGNoYXJhY3RlcjogMTAgfSxcbiAgICAgICAgICAgIGVuZDogeyBsaW5lOiAxNSwgY2hhcmFjdGVyOiAyMCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgbmV3VGV4dDogJ2RlZicsXG4gICAgICAgIH0sXG4gICAgICBdKTtcbiAgICAgIGNvbnN0IGFjdHVhbCA9IGF3YWl0IENvZGVGb3JtYXRBZGFwdGVyLmZvcm1hdFJhbmdlKGNvbm5lY3Rpb24sIGZha2VFZGl0b3IsIG5ldyBSYW5nZShbMCwgMF0sIFsxLCAxXSkpO1xuICAgICAgZXhwZWN0KGFjdHVhbC5sZW5ndGgpLnRvLmVxdWFsKDIpO1xuICAgICAgZXhwZWN0KGFjdHVhbFswXS5uZXdUZXh0KS50by5lcXVhbCgnYWJjJyk7XG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLnN0YXJ0LnJvdykudG8uZXF1YWwoNSk7XG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLnN0YXJ0LmNvbHVtbikudG8uZXF1YWwoMTApO1xuICAgICAgZXhwZWN0KGFjdHVhbFsxXS5vbGRSYW5nZS5lbmQucm93KS50by5lcXVhbCgxNSk7XG4gICAgICBleHBlY3QoYWN0dWFsWzFdLm9sZFJhbmdlLmVuZC5jb2x1bW4pLnRvLmVxdWFsKDIwKTtcbiAgICAgIGV4cGVjdChhY3R1YWxbMV0ubmV3VGV4dCkudG8uZXF1YWwoJ2RlZicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlRG9jdW1lbnRSYW5nZUZvcm1hdHRpbmdQYXJhbXMnLCAoKSA9PiB7XG4gICAgaXQoJ3JldHVybnMgdGhlIHRhYiBzaXplIGZyb20gdGhlIGVkaXRvcicsICgpID0+IHtcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFBhdGgnKS5yZXR1cm5zKCcvYS9iL2MvZC50eHQnKTtcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFRhYkxlbmd0aCcpLnJldHVybnMoMSk7XG4gICAgICBzaW5vbi5zdHViKGZha2VFZGl0b3IsICdnZXRTb2Z0VGFicycpLnJldHVybnMoZmFsc2UpO1xuXG4gICAgICBjb25zdCBhY3R1YWwgPSBDb2RlRm9ybWF0QWRhcHRlci5jcmVhdGVEb2N1bWVudFJhbmdlRm9ybWF0dGluZ1BhcmFtcyhmYWtlRWRpdG9yLCBuZXcgUmFuZ2UoWzEsIDBdLCBbMiwgM10pKTtcblxuICAgICAgZXhwZWN0KGFjdHVhbC50ZXh0RG9jdW1lbnQpLnRvLmVxbCh7IHVyaTogJ2ZpbGU6Ly8vYS9iL2MvZC50eHQnIH0pO1xuICAgICAgZXhwZWN0KGFjdHVhbC5yYW5nZSkudG8uZXFsKHtcbiAgICAgICAgc3RhcnQ6IHsgbGluZTogMSwgY2hhcmFjdGVyOiAwIH0sXG4gICAgICAgIGVuZDogeyBsaW5lOiAyLCBjaGFyYWN0ZXI6IDMgfSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGFjdHVhbC5vcHRpb25zLnRhYlNpemUpLnRvLmVxdWFsKDEpO1xuICAgICAgZXhwZWN0KGFjdHVhbC5vcHRpb25zLmluc2VydFNwYWNlcykudG8uZXF1YWwoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0Rm9ybWF0T3B0aW9ucycsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyB0aGUgdGFiIHNpemUgZnJvbSB0aGUgZWRpdG9yJywgKCkgPT4ge1xuICAgICAgc2lub24uc3R1YihmYWtlRWRpdG9yLCAnZ2V0VGFiTGVuZ3RoJykucmV0dXJucygxNyk7XG4gICAgICBjb25zdCBvcHRpb25zID0gQ29kZUZvcm1hdEFkYXB0ZXIuZ2V0Rm9ybWF0T3B0aW9ucyhmYWtlRWRpdG9yKTtcbiAgICAgIGV4cGVjdChvcHRpb25zLnRhYlNpemUpLnRvLmVxdWFsKDE3KTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIHRoZSBzb2Z0IHRhYiBzZXR0aW5nIGZyb20gdGhlIGVkaXRvcicsICgpID0+IHtcbiAgICAgIHNpbm9uLnN0dWIoZmFrZUVkaXRvciwgJ2dldFNvZnRUYWJzJykucmV0dXJucyh0cnVlKTtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSBDb2RlRm9ybWF0QWRhcHRlci5nZXRGb3JtYXRPcHRpb25zKGZha2VFZGl0b3IpO1xuICAgICAgZXhwZWN0KG9wdGlvbnMuaW5zZXJ0U3BhY2VzKS50by5iZS50cnVlO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29udmVydExzVGV4dEVkaXQnLCAoKSA9PiB7XG4gICAgaXQoJ3JldHVybnMgb2xkUmFuZ2UgYW5kIG5ld1RleHQgZnJvbSBhIHRleHRFZGl0JywgKCkgPT4ge1xuICAgICAgY29uc3QgdGV4dEVkaXQgPSB7XG4gICAgICAgIHJhbmdlOiB7XG4gICAgICAgICAgc3RhcnQ6IHsgbGluZTogMSwgY2hhcmFjdGVyOiAwIH0sXG4gICAgICAgICAgZW5kOiB7IGxpbmU6IDIsIGNoYXJhY3RlcjogMyB9LFxuICAgICAgICB9LFxuICAgICAgICBuZXdUZXh0OiAnYWJjLWRlZicsXG4gICAgICB9O1xuICAgICAgY29uc3QgYWN0dWFsID0gQ29udmVydC5jb252ZXJ0THNUZXh0RWRpdCh0ZXh0RWRpdCk7XG4gICAgICBleHBlY3QoYWN0dWFsLm9sZFJhbmdlKS50by5lcWwobmV3IFJhbmdlKFsxLCAwXSwgWzIsIDNdKSk7XG4gICAgICBleHBlY3QoYWN0dWFsLm5ld1RleHQpLnRvLmVxdWFsKCdhYmMtZGVmJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=